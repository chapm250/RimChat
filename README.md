# RimChat

AI-powered voiced conversations for RimWorld. Bring your colony to life with dynamic, contextual dialogue generated by advanced language models and synthesized with realistic text-to-speech voices.

## Overview

RimChat integrates cutting-edge AI technology into RimWorld to create immersive, context-aware conversations between your colonists. Every interaction‚Äîfrom casual chitchat to heated arguments, romantic proposals to prisoner recruitment‚Äîcan generate unique dialogue that reflects each pawn's personality, thoughts, backstory, and current situation.

## Features

### ü§ñ Multiple AI Language Models
- **OpenAI GPT-5.1** - Latest GPT model with advanced reasoning
- **Anthropic Claude** - Haiku 4.5 and Opus 4.5 support
- **Google Gemini** - Gemini 3 Pro with thinking capabilities

### üéôÔ∏è Multiple Voice Providers
- **ElevenLabs** - Premium natural voices
- **OpenAI TTS** - Reliable text-to-speech
- **Resemble AI** - Additional voice variety

### üí≠ Smart Context Awareness
The AI generates dialogue based on:
- Current thoughts and mood
- Childhood and adulthood backstories
- Active job or task
- Recent colony events
- Relationship with conversation partner
- Physical pain and injuries (with specific body part references)
- Positive vs negative emotional states

### üé≠ Configurable Interaction Types
Customize talk probability (0-100%) for:

**Social Interactions:**
- Chitchat
- Deep Talk
- Slights
- Insults
- Kind Words

**Romance:**
- Romance Attempts
- Marriage Proposals
- Breakups

**Animals:**
- Animal Chat
- Taming Attempts
- Training Attempts
- Nuzzle Responses
- Release to Wild

**Prisoners:**
- Build Rapport
- Recruitment Attempts
- Jailbreak Incitement

### ‚öôÔ∏è Extensive Customization
- Fully editable AI instruction template
- Keyword substitution system
- Adjustable conversation frequency
- Per-interaction type probability controls
- Unique voice assignment per pawn

## Requirements

### API Keys Required

You will need API keys from your chosen providers:

**Language Model Provider (choose one):**
- OpenAI API key ([Get it here](https://platform.openai.com/api-keys))
- Anthropic Claude API key ([Get it here](https://console.anthropic.com/))
- Google Gemini API key ([Get it here](https://aistudio.google.com/app/apikey))

**Text-to-Speech Provider (choose one):**
- ElevenLabs API key ([Get it here](https://elevenlabs.io/))
- OpenAI API key (same as above if using OpenAI)
- Resemble AI API key ([Get it here](https://www.resemble.ai/))

‚ö†Ô∏è **Important:** API usage incurs costs. Review your chosen provider's pricing before use. Start with low talk percentages to manage costs.

### System Requirements
- Active internet connection
- RimWorld 1.5 or later
- Sufficient bandwidth for API calls

## Installation

### Steam Workshop
1. Subscribe to RimChat on the Steam Workshop
2. Enable the mod in RimWorld's mod configuration
3. Restart RimWorld

### Manual Installation
1. Download the latest release
2. Extract to your RimWorld Mods folder:
   - Windows: `C:\Program Files (x86)\Steam\steamapps\common\RimWorld\Mods\`
   - Mac: `~/Library/Application Support/Steam/steamapps/common/RimWorld/RimWorldMac.app/Mods/`
   - Linux: `~/.steam/steam/steamapps/common/RimWorld/Mods/`
3. Enable RimChat in the mod configuration menu

## Configuration

### Initial Setup

1. **Open Mod Settings:**
   - Main Menu ‚Üí Options ‚Üí Mod Settings ‚Üí RimChat

2. **Select Your LLM Provider:**
   - Choose between OpenAI, Claude, or Gemini

3. **Enter API Keys:**
   - Paste your LLM provider API key
   - Paste your TTS provider API key
   - Keys are saved locally and never uploaded

4. **Select Your TTS Provider:**
   - Choose between ElevenLabs, OpenAI, or Resemble

5. **Adjust Talk Chances:**
   - Set probability percentages for each interaction type
   - Recommended starting values:
     - Chitchat: 10-20%
     - Deep Talk: 20-30%
     - Insults: 50-100%
     - Romance: 100%
     - Breakups: 100%

6. **Set Conversation Frequency:**
   - Minimum time between talks (default: 1 minute)
   - Lower values = more frequent conversations

### Advanced Configuration

#### Custom AI Instructions

The instruction template supports keyword substitution:

| Keyword | Description |
|---------|-------------|
| `{PAWN_NAME}` | Name of the speaking pawn |
| `{RECIPIENT_NAME}` | Name of the pawn being spoken to |
| `{DAYS_PASSED}` | Days since colony landing |
| `{JOB}` | Current job or task |
| `{CHILDHOOD}` | Childhood backstory |
| `{ADULTHOOD}` | Adulthood backstory |
| `{HISTORY}` | Recent colony events |

**Example template:**
```
You are {PAWN_NAME}, a colonist on a rimworld talking to {RECIPIENT_NAME}.
You crashed {DAYS_PASSED} days ago and are currently {JOB}.
Your childhood: {CHILDHOOD}
Your adulthood: {ADULTHOOD}
Recent events: {HISTORY}

Respond naturally in 1-3 sentences based on your personality and current thoughts.
```

## Usage

### How Conversations Trigger

1. **Pawn Interaction Occurs:**
   - Pawns engage in social interactions naturally
   - Interaction must match one of the configured types

2. **Probability Check:**
   - RimChat rolls against the configured talk chance
   - If successful, conversation generation begins

3. **Cooldown Check:**
   - Ensures minimum time has passed since last conversation
   - Prevents spam and manages API costs

4. **AI Generation:**
   - Context is gathered (thoughts, backstory, events)
   - LLM generates contextual dialogue
   - Process is asynchronous (won't freeze game)

5. **Voice Synthesis:**
   - Generated text is sent to TTS provider
   - Audio is synthesized with pawn's assigned voice
   - Music volume automatically lowers during speech

6. **Playback:**
   - Audio plays through the game
   - Music volume returns to normal after completion

### Voice Assignment

- Each pawn is automatically assigned a unique voice on first conversation
- Voice is based on pawn gender (male/female voice pools)
- Voice assignments are saved with your game
- Changing TTS providers will reassign voices appropriately

### Thought-Based Conversations

**Positive Thoughts:**
```
"You (John) just had the following thought: beautiful environment.
You want to discuss it with your crewmate Sarah. Express how you're feeling about this."
```

**Negative Thoughts:**
```
"Feeling pain. This pain in your left leg has been affecting you (John),
and you want to discuss it with your crewmate Sarah. Express how you're feeling about this."
```

**Pain Detection:**
- Automatically detects pain-related thoughts
- Identifies the specific body part causing pain
- Generates more detailed, contextual dialogue

## Voice Pools

### ElevenLabs
**Male Voices:** 5 unique voices
**Female Voices:** 5 unique voices

### OpenAI TTS
**Male Voices:** echo, fable, onyx, ash, ballad, cedar
**Female Voices:** alloy, nova, shimmer, coral, marin, sage

### Resemble AI
**Male Voices:** 7 unique voice IDs
**Female Voices:** 8 unique voice IDs

## Cost Management Tips

1. **Start Conservative:**
   - Begin with 10-20% talk chances
   - Monitor API usage through provider dashboards
   - Increase percentages gradually

2. **Prioritize High-Impact Moments:**
   - Set 100% for dramatic events (romance, breakups, insults)
   - Set lower percentages for frequent interactions (chitchat)

3. **Use Cooldowns:**
   - Increase minimum time between talks
   - Reduces overall conversation frequency

4. **Choose Cost-Effective Providers:**
   - Compare pricing across LLM providers
   - Haiku models are typically cheaper than Opus/GPT-5
   - Some TTS providers offer free tiers

## Troubleshooting

### No Conversations Triggering

**Check:**
- ‚úÖ API keys are entered correctly in settings
- ‚úÖ Talk chance percentages are above 0%
- ‚úÖ Sufficient time has passed since last conversation
- ‚úÖ Pawns are actually interacting (check interaction log)
- ‚úÖ Internet connection is active

### Slow or Missing Audio

**Solutions:**
- Check API provider status pages
- Verify API keys have sufficient credits
- Test with different TTS provider
- Check game logs for error messages

### Same Thought Repeated

**Solution:**
- This has been fixed in the latest version
- Thoughts now use proper randomization
- Update to latest RimChat version

### Voice Doesn't Match Pawn

**Solution:**
- Voices are randomly assigned within gender pools
- Assignments persist across game loads
- Changing TTS providers will reassign voices

### API Errors in Logs

**Common Issues:**
- **401 Unauthorized:** Invalid API key
- **429 Rate Limit:** Too many requests, increase cooldown
- **500 Server Error:** Provider issue, try again later
- **Insufficient Credits:** Add credits to provider account

## Technical Details

### Architecture

```
Interaction Event
    ‚Üì
Probability Check (ChanceUtil)
    ‚Üì
Context Gathering (Chat.Talk)
    ‚Üì
LLM API Call (GetOpenAIResponseAsync/GetClaudeResponseAsync/GetGeminiResponseAsync)
    ‚Üì
Response Parsing
    ‚Üì
TTS API Call (Vocalize/VocalizeOpenAI/VocalizeResemble)
    ‚Üì
Audio Playback (AudioSource)
```

### File Structure

```
RimChat/
‚îú‚îÄ‚îÄ Source/RimChat/
‚îÇ   ‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat.cs           # Main conversation logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chatter.cs        # Interaction handling & voice management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Compatibility.cs  # Mod compatibility
‚îÇ   ‚îú‚îÄ‚îÄ Access/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Reflection.cs     # RimWorld API access
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [Harmony Patches] # Game integration
‚îÇ   ‚îú‚îÄ‚îÄ Configuration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Setting.cs        # Settings infrastructure
‚îÇ   ‚îú‚îÄ‚îÄ Mod.cs                # Mod entry point & UI
‚îÇ   ‚îî‚îÄ‚îÄ Settings.cs           # Configuration values
‚îú‚îÄ‚îÄ About/
‚îÇ   ‚îî‚îÄ‚îÄ About.xml             # Mod metadata
‚îî‚îÄ‚îÄ README.md
```

### API Integration

**OpenAI:**
- Endpoint: `https://api.openai.com/v1/responses`
- Model: `gpt-5.1-chat-latest`
- TTS: `gpt-4o-mini-tts`

**Claude:**
- Endpoint: `https://api.anthropic.com/v1/messages`
- Model: `claude-haiku-4-5`
- Version: `2023-06-01`

**Gemini:**
- Endpoint: `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-preview:generateContent`
- Safety Settings: All categories set to `BLOCK_NONE`

### Save Data

Voice assignments are stored in the world component and saved with your game file:
- Pawn ‚Üí Voice ID mapping
- Voice uniqueness enforcement
- Automatic cleanup of dead/invalid pawns

## Performance Considerations

- **Async Operations:** API calls don't block gameplay
- **Music Management:** Volume automatically adjusted during speech
- **Voice Caching:** Assignments persist to minimize API calls
- **Cooldown System:** Prevents excessive API usage
- **Random Selection:** Properly randomized thought selection

## Known Issues

- None currently reported

## Planned Features

- [ ] Custom voice assignment UI
- [ ] Conversation history log
- [ ] Additional context options
- [ ] Mod API for extensibility
- [ ] Voice preview in settings

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This mod is provided as-is for use with RimWorld. Please ensure compliance with:
- RimWorld's modding guidelines
- API provider terms of service
- Applicable software licenses

## Credits

**Development:** RimChat Team
**Powered By:**
- OpenAI GPT & TTS
- Anthropic Claude
- Google Gemini
- ElevenLabs
- Resemble AI

**Special Thanks:**
- RimWorld modding community
- Ludeon Studios for RimWorld
- All contributors and testers

## Support

**Issues & Bugs:**
Report on the GitHub issues page or Steam Workshop discussion

**API Provider Support:**
Contact your API provider for account/billing issues

**Community:**
Join the discussion on the RimWorld Discord or Steam Workshop

---

**Enjoy your AI-powered colony conversations!** üéÆüó£Ô∏è

*Remember: Start with low talk percentages and monitor your API costs.*
